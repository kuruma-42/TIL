# IP (Internet Protocol)

### 네트워크 계층 & 데이터 링크 계층의 한계를 극복하는 프로토콜

### IP 버전 4(이하 IPv4)와 IP 버전 6(이하 IPv6)

- IPv4 위주로 학습
- IPv6 뒷 부분

### IP의 공식적인 두 기능

- 주소 지정 (IP addressing)
- 단편화 (IP fragmentation)
- RFC 791
    - 아이피는 상기의 두 개의 기능을 구현한다
    - Request for Comments 문서
        - 네트워크 / 인터넷 관련 신기술 제안 의견 등을 남긴 문서
        - 일부 RFC는 오늘날까지 사용되는 인터넷 표준이 됨
            - 이러한 RFC 문서에는 번호가 부여됨(e.g. RFC791)
            - “세상에서 가장 정확한 네트워크 이론 지식”
            - 새 RFC 문서로 개정 출판이 될지 언정, 폐지되거나 수정되지 않음

### 주소 지정

- IP 주소 (IPv4 주소)를 바탕으로 송수신 대상을 지정하는 것을 의미
- 4바이트 (32비트)로 하나의 주소를 표현
- 숫자당 8비트로 표현: 0 ~ 255 범위 안에 있는 네 개의 10진수로 표기
- 각 숫자는 점(.)으로 구분
    - 점으로 구분된 8비트(0~255 범위의 10진수)를 옥텟(octet)이라 함
- e.g. 192.168.1.1

### 단편화

- 전송하고자 하는 패킷의 크기를 MTU 이하의 복수의 패킷으로 나누는 것
    - MTU(Maximum Transmission Unit)
        - 한 번에 전송 가능한 IP 패킷의 최대 크기
        - IP 패킷의 헤더도 MTU 크기에 포함
        - 일반적인 MTU 크기는 1500바이트, MTU 크기 이하로 나누어진 패킷은 수신지에 도착하면 다시 재조합
        

### IPv4 패킷의 핵심 필드

- 식별자
    - 패킷에 할당된 번호
    - 쪼개져서 도착한 IPv4 패킷들이 어떤 메시지에서 쪼개졌는지 알기 위해 사용
- 플래그
    - 세 개의 비트로 구성
    - 첫 번째 비트는 항상 0: 현재 사용되지 않음
    - DF 비트 (Don’t Fragment) - IP 단편화를 수행하지 말라는 표시
        - 1 → 단편화 수행하지 말라
        - 0 → IP 단편화 가능
    - MF 비트 (More Fragment) - 단편화된 패킷이 더 있는 지를 나타냄
        - 1 → 쪼개진 패킷이 더 존재
        - 0 → 해당 패킷이 마지막 패킷임을 의미
- 단편화 오프셋
    - 초기 데이터에서 몇 번째로 덜어진 패킷인지를 나타냄
        - 단편화되어 전송되는 패킷들은 수신지에 순서대로 도착하지 않을 수 있음
        - 수신지가 패킷들을 순서대로 재조합하려면 단편화된 패킷이 초기 데이터에서 몇 번째에 해당하는 패킷인지 알아야 함
- 상기의 세 가지 기능들로 단편화가 주로 이루어짐

- TTL (Time To Live)
    - 패킷의 수명
    - 무의미한 패킷이 네트워크 상에 지속적으로 남아있는 것을 방지하기 위해 존재
    - 패킷이 하나의 라우터를 거칠 때 마다 TTL이 1씩 감소, TTL값이 0으로 떨어진 패킷은 패기
    - 홉(hop) - 패킷이 호스트 또는 라우터에 한 번 전달되는 것
        - 즉 TTL 필드의 값은 홉마다 1씩 감소
- 프로토콜
    - 상위 계층의 프로토콜이 무엇인지 나타내는 필드
    - e.g. 전송 계층의 대표적인 프로토콜인 TCP는 6번, UDP는 17번
- 송신지 IP주소
- 수신지 IP주소

### IPv6
- 이론적으로 할당 가능한 IPv4 주소 개수는 몇 개 일까?
    - 총 2^32개로 약 43억 개
- 과연 충분할까?
    - NO! 전 세계 인구가 하나씩 IP 주소를 가지고 있어도 부족한 숫자
    - 결국 약 43억개 라는 IPv4의 주소 총량은 쉽게 고갈
- 15바이트 (128 비트)로 주소를 표현할 수 있고, 콜론(:)으로 구분된 8개 그룹의 16진수로 표기
    - 이론적으로 할당 가능한 IPv6 주소는 2^128개
        - 사실상 무한에 가까운 수 할당 가능
- 핵심 필드
    - 다음 헤더
        - 상위 계층의 프로토콜 또는 확장 헤더를 가리키는 필드
        - 확장헤더?
            - IPv6는 기본 헤더와 더불어 확장헤더라는 추가 헤더를 가질 수 있다
            - 홉간 옵션 (Hop by Hop option)
            - 수신지 옵션 (Destination Options)
            - 라우팅 (Routing)
            - 단편 (Fragment) ← 단편화
                - IPv6는 단편화 확장 헤더를 통해 단편화가 이루어짐
                - 단편화 확장 헤더에도 다음 헤더 필드가 있음
                    - 예약됨(reserved)과 예약(re) 필드는 0으로 설정되어 사용되지 않음
                    - 단편화 오프셋(fragment offset)과 M 플래그(M flag), 식별자(Identifiacation) 필드
                        - 단편화 오프셋 - 전체 메시지에서 현재 단편화된 패킷의 위치(IPv4의 단편화 오프셋 필드)
                        - M플래그는 1일 경우 더 많은 단편화된 패킷이 있음을, 0일 경우 마지막 패킷(IPv4의 MF 플래그 필드)
                        - 식별자는 동일한 메시지에서부터 단편화된 패킷임을 식별(IPvr4의 식별자 필드)
            - ESP (Encapsulating Security Payload), AH(Authentication Header)
    - 홉 제한
        - IPv4 패킷의 TTL 필드와 비슷
        - 패킷의 수명을 나타내는 필드
    - 송신지 IP주소
    - 수신지 IP주소
